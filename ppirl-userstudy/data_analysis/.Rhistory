# user_kapr <-
raw_user_data %>%
filter(type %in% c("open_cell", "kapr")) %>%
group_by(uid) %>%
mutate(timedelta = lead(timestamp) - timestamp,
group_kapr = if_else((timedelta < 40) & !is.na(timestamp), 1, 0))
# user_kapr <-
raw_user_data %>%
filter(type %in% c("open_cell", "kapr")) %>%
group_by(uid) %>%
mutate(timedelta = lead(timestamp) - timestamp,
group_kapr = if_else((timedelta < 40), 1, 0) %>% if_else(is.na(.), 0, .))
# user_kapr <-
raw_user_data %>%
filter(type %in% c("open_cell", "kapr")) %>%
group_by(uid) %>%
mutate(timedelta = lead(timestamp) - timestamp,
group_kapr = if_else((timedelta < 40), 1, 0) %>% if_else(is.na(.), 0, .) %>% cumsum())
?spread
# user_kapr <-
raw_user_data %>%
filter(type %in% c("open_cell", "kapr")) %>%
group_by(uid) %>%
mutate(timedelta = lead(timestamp) - timestamp,
group_kapr = if_else((timedelta < 40), 1, 0) %>% if_else(is.na(.), 0, .) %>% cumsum()) %>%
spread(type, value)
raw_user_data %>%
filter(type %in% c("open_cell", "kapr")) %>%
spread(type, value) %>%
group_by(uid, open_cell)
# user_kapr <-
raw_user_data %>%
filter(type %in% c("open_cell", "kapr")) %>%
spread(type, value) %>%
group_by(uid, open_cell) %>%
mutate(timedelta = lead(timestamp) - timestamp,
group_kapr = if_else((timedelta < 40), 1, 0) %>% if_else(is.na(.), 0, .) %>% cumsum()) %>%
user_questions_data <-
raw_user_data %>%
filter(type == "final_answer") %>%
separate(value, into = c("question", "choice"), sep = "a", convert = T) %>%
mutate(question = question %>% str_replace("p", "") %>% as.integer(),
confidence = if_else(choice > 3, choice - 3, abs(choice - 4)),
user_answer = if_else(choice > 3, 1, 0)) %>%
left_join(questions_info, by = "question") %>%
mutate(grade = ifelse(user_answer == actual_answer, 1, 0),
sample = as.integer(uid)%%10) %>%
select(-type, -timestamp, -extra) %>%
mutate_all(as.integer)
# user_kapr <-
raw_user_data %>%
filter(type %in% c("open_cell", "kapr")) %>%
spread(type, value) %>%
group_by(uid, open_cell) %>%
mutate(timedelta = lead(timestamp) - timestamp,
group_kapr = if_else((timedelta < 40), 1, 0) %>% if_else(is.na(.), 0, .) %>% cumsum())
# user_kapr <-
raw_user_data %>%
filter(type %in% c("open_cell", "kapr")) %>%
spread(type, value) %>%
group_by(uid, open_cell) %>%
mutate(timedelta = timestamp - lag(timestamp),
group_kapr = if_else((timedelta < 40), 1, 0) %>% if_else(is.na(.), 0, .) %>% cumsum())
# user_kapr <-
raw_user_data %>%
filter(type %in% c("open_cell", "kapr")) %>%
spread(type, value) %>%
group_by(uid) %>%
mutate(timedelta = timestamp - lag(timestamp),
group_kapr = if_else((timedelta < 40), 1, 0) %>% if_else(is.na(.), 0, .) %>% cumsum())
# user_kapr <-
raw_user_data %>%
filter(type %in% c("open_cell", "kapr")) %>%
spread(type, value) %>%
group_by(uid) %>%
mutate(timedelta = lead(timestamp) - (timestamp),
group_kapr = if_else((timedelta < 40), 1, 0) %>% if_else(is.na(.), 0, .) %>% cumsum())
group_by(group_kapr) %>%
summarise(kapr = last(kapr))
# user_kapr <-
raw_user_data %>%
filter(type %in% c("open_cell", "kapr")) %>%
spread(type, value) %>%
group_by(uid) %>%
mutate(timedelta = lead(timestamp) - (timestamp),
group_kapr = if_else((timedelta < 40), 1, 0) %>% if_else(is.na(.), 0, .) %>% cumsum()) %>%
group_by(group_kapr) %>%
summarise(kapr = last(kapr))
raw_user_data %>%
filter(type %in% c("open_cell", "kapr")) %>%
spread(type, value) %>%
group_by(uid) %>%
mutate(timedelta = lead(timestamp) - (timestamp),
group_kapr = if_else((timedelta < 40), 1, 0) %>% if_else(is.na(.), 0, .) %>% cumsum())
# user_kapr <-
raw_user_data %>%
filter(type %in% c("open_cell", "kapr")) %>%
spread(type, value) %>%
group_by(uid) %>%
mutate(timedelta = lead(timestamp) - (timestamp),
group_kapr = if_else((timedelta < 40), 1, 0) %>% if_else(is.na(.), 0, .) %>% cumsum()) %>%
group_by(group_kapr) %>%
summarise(kapr = last(kapr),
cell = first(open_cell) %>% str_extract(one_or_more(DIGIT)))
pacman::p_load(tidyverse, rebus)
# user_kapr <-
raw_user_data %>%
filter(type %in% c("open_cell", "kapr")) %>%
spread(type, value) %>%
group_by(uid) %>%
mutate(timedelta = lead(timestamp) - (timestamp),
group_kapr = if_else((timedelta < 40), 1, 0) %>% if_else(is.na(.), 0, .) %>% cumsum()) %>%
group_by(group_kapr) %>%
summarise(kapr = last(kapr),
cell = first(open_cell) %>% str_extract(one_or_more(DIGIT)))
# user_kapr <-
raw_user_data %>%
filter(type %in% c("open_cell", "kapr")) %>%
spread(type, value) %>%
group_by(uid) %>%
mutate(timedelta = lead(timestamp) - (timestamp),
group_kapr = if_else((timedelta < 40), 1, 0) %>% if_else(is.na(.), 0, .) %>% cumsum()) %>%
group_by(uid, group_kapr) %>%
summarise(kapr = last(kapr),
cell = first(open_cell) %>% str_extract(one_or_more(DIGIT)),
timestamp = first(timestamp),
timedelta = first(timedelta))
raw_user_data %>%
filter(type %in% c("open_cell", "kapr")) %>%
group_by(uid) %>%
arrange(timestamp) %>%
spread(type, value)
raw_user_data %>%
filter(type %in% c("open_cell", "kapr")) %>%
group_by(uid) %>%
arrange(timestamp) %>%
spread(type, value) %>%
mutate(timedelta = lead(timestamp) - (timestamp),
group_kapr = if_else((timedelta < 40), 1, 0) %>% if_else(is.na(.), 0, .) %>% cumsum())
raw_user_data %>%
filter(type %in% c("open_cell", "kapr")) %>%
group_by(uid) %>%
arrange(timestamp) %>%
spread(type, value) %>%
mutate(timedelta = lead(timestamp) - (timestamp),
group_kapr = if_else((timedelta < 40), 1, 0) %>% if_else(is.na(.), 0, .) %>% cumsum()) %>%
group_by(uid, group_kapr) %>%
summarise(kapr = last(kapr),
cell = first(open_cell) %>% str_extract(one_or_more(DIGIT)),
timestamp = first(timestamp),
timedelta = first(timedelta))
# user_kapr <-
raw_user_data %>%
filter(type %in% c("open_cell", "kapr")) %>%
group_by(uid) %>%
arrange(timestamp) %>%
spread(type, value) %>%
mutate(timedelta = lead(timestamp) - (timestamp),
group_kapr = if_else((timedelta < 50), 1, 0) %>% if_else(is.na(.), 0, .) %>% cumsum()) %>%
group_by(uid, group_kapr) %>%
summarise(kapr = last(kapr),
cell = first(open_cell) %>% str_extract(one_or_more(DIGIT)),
timestamp = first(timestamp),
timedelta = first(timedelta))
# user_kapr <-
raw_user_data %>%
filter(type %in% c("open_cell", "kapr")) %>%
group_by(uid) %>%
arrange(timestamp) %>%
spread(type, value) %>%
mutate(timedelta = lead(timestamp) - (timestamp),
group_kapr = if_else((timedelta < 50), 1, 0) %>% if_else(is.na(.), 0, .) %>% cumsum()) %>%
group_by(uid, group_kapr) %>%
summarise(kapr = last(kapr),
cell = first(open_cell) %>% str_extract(one_or_more(DIGIT)),
timestamp = first(timestamp),
timedelta = first(timedelta)) %>%
ungroup() %>%
mutate(kapr = lead(kapr) - kapr)
# user_kapr <-
raw_user_data %>%
filter(type %in% c("open_cell", "kapr")) %>%
group_by(uid) %>%
arrange(timestamp) %>%
spread(type, value) %>%
mutate(timedelta = lead(timestamp) - (timestamp),
group_kapr = if_else((timedelta < 50), 1, 0) %>% if_else(is.na(.), 0, .) %>% cumsum()) %>%
group_by(uid, group_kapr) %>%
summarise(kapr = last(kapr),
cell = first(open_cell) %>% str_extract(one_or_more(DIGIT)),
timestamp = first(timestamp),
timedelta = first(timedelta)) %>%
ungroup() %>%
mutate(kapr = lead(kapr) - kapr)
raw_user_data %>%
filter(type %in% c("open_cell", "kapr")) %>%
group_by(uid) %>%
arrange(timestamp) %>%
spread(type, value) %>%
mutate(timedelta = lead(timestamp) - (timestamp),
group_kapr = if_else((timedelta < 50), 1, 0) %>% if_else(is.na(.), 0, .) %>% cumsum()) %>%
group_by(uid, group_kapr) %>%
summarise(kapr = last(kapr),
cell = first(open_cell) %>% str_extract(one_or_more(DIGIT)),
timestamp = first(timestamp),
timedelta = first(timedelta)) %>%
ungroup()
raw_user_data %>%
filter(type %in% c("open_cell", "kapr")) %>%
group_by(uid) %>%
arrange(timestamp) %>%
spread(type, value) %>%
mutate(timedelta = lead(timestamp) - (timestamp),
group_kapr = if_else((timedelta < 50), 1, 0) %>% if_else(is.na(.), 0, .) %>% cumsum()) %>%
group_by(uid, group_kapr) %>%
summarise(kapr = last(kapr),
cell = first(open_cell) %>% str_extract(one_or_more(DIGIT)),
timestamp = first(timestamp),
timedelta = first(timedelta)) %>%
ungroup() %>% View()
raw_user_data
raw_user_data %>%
filter(value %>% str_detect(286))
filter(value %>% str_detect("286"))
raw_user_data
raw_user_data %>% filter(value %>% str_detect("286"))
raw_user_data %>% View
View(raw_data)
raw_user_data %>%
filter(type %in% c("open_cell", "kapr")) %>%
group_by(uid) %>%
arrange(timestamp) %>%
spread(type, value) %>%
mutate(timedelta = lead(timestamp) - (timestamp),
group_kapr = if_else((timedelta < 50), 1, 0) %>% if_else(is.na(.), 0, .) %>% cumsum()) %>%
group_by(uid, group_kapr) %>%
summarise(kapr = last(kapr),
cell = first(open_cell) %>% str_extract(one_or_more(DIGIT)),
timestamp = first(timestamp),
timedelta = first(timedelta)) %>%
ungroup()
raw_user_data %>%
filter(type %in% c("open_cell", "kapr")) %>%
group_by(uid) %>%
arrange(timestamp) %>%
spread(type, value) %>%
mutate(timedelta = lead(timestamp) - (timestamp),
group_kapr = if_else((timedelta < 50), 1, 0) %>% if_else(is.na(.), 0, .) %>% cumsum()) %>%
group_by(uid, group_kapr) %>%
summarise(kapr = last(kapr),
cell = first(open_cell) %>% str_extract(one_or_more(DIGIT)),
timestamp = first(timestamp),
timedelta = first(timedelta)) %>%
ungroup() %>% View()
raw_user_data %>%
filter(type %in% c("open_cell", "kapr")) %>%
group_by(uid) %>%
arrange(timestamp) %>%
spread(type, value) %>%
mutate(timedelta = lead(timestamp) - (timestamp),
group_kapr = if_else((timedelta < 50), 1, 0) %>% if_else(is.na(.), 0, .) %>% cumsum())
raw_user_data %>%
filter(type %in% c("open_cell", "kapr")) %>%
group_by(uid) %>%
arrange(timestamp) %>%
spread(type, value) %>%
mutate(timedelta = lead(timestamp) - (timestamp),
group_kapr = if_else((timedelta < 50), 1, 0) %>% if_else(is.na(.), 0, .) %>% cumsum()) %>% View()
raw_user_data %>%
filter(type %in% c("open_cell", "kapr")) %>%
group_by(uid) %>%
arrange(timestamp)
raw_user_data %>%
filter(type %in% c("open_cell", "kapr")) %>%
group_by(uid) %>%
arrange(timestamp) %>%
spread(type, value)
user_questions_data <-
raw_user_data %>%
filter(type == "final_answer") %>%
separate(value, into = c("question", "choice"), sep = "a", convert = T) %>%
mutate(question = question %>% str_replace("p", "") %>% as.integer(),
confidence = if_else(choice > 3, choice - 3, abs(choice - 4)),
user_answer = if_else(choice > 3, 1, 0)) %>%
left_join(questions_info, by = "question") %>%
mutate(grade = ifelse(user_answer == actual_answer, 1, 0),
sample = as.integer(uid)%%10) %>%
select(-type, -timestamp, -extra) %>%
mutate_all(as.integer)
attention_test = c(1,7,13,19,25,31)
user_questions_data %>%
group_by(uid, sample) %>%
summarise(grade36 = sum(grade),
grade30 = sum(grade[!(question_type %in% attention_test)]),
percent_attention = mean(grade[question_type %in% attention_test]),
percent_attention = ifelse(is.nan(percent_attention), 1, 0),
percent36 = mean(grade)*100,
percent30 = grade30*100/30,
mean_confidence = mean(confidence),
mean_confidence_right = mean(confidence[grade == 1]),
mean_confidence_wrong = mean(confidence[grade == 0]))
user_questions_data
user_questions_data %>% pull(uid) %>% unique()
# user_kapr <-
raw_user_data %>%
filter(type %in% c("open_cell", "kapr")) %>%
group_by(uid) %>%
arrange(timestamp) %>%
spread(type, value) %>%
mutate(timedelta = lead(timestamp) - (timestamp),
group_kapr = if_else((timedelta < 50), 1, 0) %>% if_else(is.na(.), 0, .) %>% cumsum()) %>%
group_by(uid, group_kapr) %>%
summarise(kapr = last(kapr),
cell = first(open_cell) %>% str_extract(one_or_more(DIGIT)),
timestamp = first(timestamp),
timedelta = first(timedelta)) %>%
ungroup() %>%
mutate(kapr = lead(kapr) - kapr)
filter(type %in% c("open_cell", "kapr")) %>%
group_by(uid) %>%
arrange(timestamp) %>%
spread(type, value) %>%
mutate(timedelta = lead(timestamp) - (timestamp),
group_kapr = if_else((timedelta < 50), 1, 0) %>% if_else(is.na(.), 0, .) %>% cumsum()) %>%
group_by(uid, group_kapr) %>%
summarise(kapr = last(kapr),
cell = first(open_cell) %>% str_extract(one_or_more(DIGIT)),
timestamp = first(timestamp),
timedelta = first(timedelta)) %>%
ungroup()
raw_user_data %>%
filter(type %in% c("open_cell", "kapr")) %>%
group_by(uid) %>%
arrange(timestamp) %>%
spread(type, value) %>%
mutate(timedelta = lead(timestamp) - (timestamp),
group_kapr = if_else((timedelta < 50), 1, 0) %>% if_else(is.na(.), 0, .) %>% cumsum()) %>%
group_by(uid, group_kapr) %>%
summarise(kapr = last(kapr),
cell = first(open_cell) %>% str_extract(one_or_more(DIGIT)),
timestamp = first(timestamp),
timedelta = first(timedelta)) %>%
ungroup()
raw_user_data %>%
filter(type %in% c("open_cell", "kapr")) %>%
group_by(uid) %>%
arrange(timestamp) %>%
spread(type, value) %>%
mutate(timedelta = lead(timestamp) - (timestamp),
group_kapr = if_else((timedelta < 50), 1, 0) %>% if_else(is.na(.), 0, .) %>% cumsum()) %>%
group_by(uid, group_kapr) %>%
summarise(kapr = last(kapr),
cell = first(open_cell) %>% str_extract(one_or_more(DIGIT)),
timestamp = first(timestamp),
timedelta = first(timedelta)) %>%
ungroup() %>% View
raw_user_data %>%
filter(type %in% c("open_cell", "kapr")) %>%
group_by(uid) %>%
arrange(timestamp) %>%
spread(type, value) %>%
mutate(timedelta = lead(timestamp) - (timestamp),
group_kapr = if_else((timedelta < 50), 1, 0) %>% if_else(is.na(.), 0, .) %>% cumsum()) %>%
group_by(uid, group_kapr)
raw_user_data %>%
filter(type %in% c("open_cell", "kapr")) %>%
group_by(uid) %>%
arrange(timestamp) %>%
spread(type, value) %>%
mutate(timedelta = lead(timestamp) - (timestamp),
group_kapr = if_else((timedelta < 50), 1, 0) %>% if_else(is.na(.), 0, .) %>% cumsum()) %>%
group_by(uid, group_kapr) %>% View()
# user_kapr <-
raw_user_data %>%
filter(type %in% c("open_cell", "kapr")) %>%
group_by(uid) %>%
arrange(timestamp) %>%
spread(type, value) %>%
mutate(timedelta = lead(timestamp) - (timestamp),
group_kapr = if_else((timedelta < 50), 1, 0) %>% if_else(is.na(.), 0, .) %>% cumsum()) %>%
group_by(uid, group_kapr) %>%
summarise(kapr = last(kapr[!(kapr %>% is.na())]),
cell = first(open_cell) %>% str_extract(one_or_more(DIGIT)),
timestamp = first(timestamp),
timedelta = first(timedelta)) %>%
ungroup() %>%
mutate(kapr = lead(kapr) - kapr)
raw_user_data %>%
filter(type %in% c("open_cell", "kapr")) %>%
group_by(uid) %>%
arrange(timestamp) %>%
spread(type, value) %>%
mutate(timedelta = lead(timestamp) - (timestamp),
group_kapr = if_else((timedelta < 50), 1, 0) %>% if_else(is.na(.), 0, .) %>% cumsum()) %>%
group_by(uid, group_kapr) %>%
summarise(kapr = last(kapr[!(kapr %>% is.na())]),
cell = first(open_cell) %>% str_extract(one_or_more(DIGIT)),
timestamp = first(timestamp),
timedelta = first(timedelta))
raw_user_data %>%
filter(type %in% c("open_cell", "kapr")) %>%
group_by(uid) %>%
arrange(timestamp) %>%
spread(type, value) %>%
mutate(timedelta = lead(timestamp) - (timestamp),
group_kapr = if_else((timedelta < 50), 1, 0) %>% if_else(is.na(.), 0, .) %>% cumsum()) %>%
group_by(uid, group_kapr) %>%
summarise(kapr = last(kapr[!(kapr %>% is.na())]),
cell = first(open_cell) %>% str_extract(one_or_more(DIGIT)),
timestamp = first(timestamp),
timedelta = first(timedelta)) %>% View()
raw_user_data %>%
filter(type %in% c("open_cell", "kapr")) %>%
group_by(uid) %>%
arrange(timestamp) %>%
spread(type, value) %>%
mutate(timedelta = lead(timestamp) - (timestamp),
group_kapr = if_else((timedelta < 50), 1, 0) %>% if_else(is.na(.), 0, .) %>% cumsum()) %>%
group_by(uid, group_kapr)
raw_user_data %>%
filter(type %in% c("open_cell", "kapr")) %>%
group_by(uid) %>%
arrange(timestamp) %>%
spread(type, value) %>%
mutate(timedelta = lead(timestamp) - (timestamp),
group_kapr = if_else((timedelta < 50), 1, 0) %>% if_else(is.na(.), 0, .) %>% cumsum()) %>%
group_by(uid, group_kapr)
raw_user_data %>%
filter(type %in% c("open_cell", "kapr")) %>%
group_by(uid) %>%
arrange(timestamp) %>%
spread(type, value) %>%
mutate(timedelta = lead(timestamp) - (timestamp),
group_kapr = if_else((timedelta < 50), 1, 0) %>% if_else(is.na(.), 0, .) %>% cumsum()) %>%
group_by(uid, group_kapr) %>%
separate(value, into = c("question", "choice"), sep = "a", convert = T) %>%
mutate(question = question %>% str_replace("p", "") %>% as.integer())
raw_user_data %>%
filter(type %in% c("open_cell", "kapr")) %>%
group_by(uid) %>%
arrange(timestamp) %>%
spread(type, value) %>%
mutate(timedelta = lead(timestamp) - (timestamp),
group_kapr = if_else((timedelta < 50), 1, 0) %>% if_else(is.na(.), 0, .) %>% cumsum()) %>%
group_by(uid, group_kapr) %>%
separate(open_cell, into = c("question", "choice"), sep = "a", convert = T) %>%
mutate(question = question %>% str_replace("p", "") %>% as.integer())
raw_user_data %>%
filter(type %in% c("open_cell", "kapr")) %>%
group_by(uid) %>%
arrange(timestamp) %>%
spread(type, value) %>%
mutate(timedelta = lead(timestamp) - (timestamp),
group_kapr = if_else((timedelta < 50), 1, 0) %>% if_else(is.na(.), 0, .) %>% cumsum()) %>%
group_by(uid, group_kapr) %>%
separate(open_cell, into = c("question", "choice"), sep = "-", convert = T) %>%
mutate(question = question %>% str_replace("p", "") %>% as.integer()) %>%
summarise(kapr = last(kapr[!(kapr %>% is.na())]),
cell = first(open_cell) %>% str_extract(one_or_more(DIGIT)),
timestamp = first(timestamp),
timedelta = first(timedelta))
raw_user_data %>%
filter(type %in% c("open_cell", "kapr")) %>%
group_by(uid) %>%
arrange(timestamp) %>%
spread(type, value) %>%
mutate(timedelta = lead(timestamp) - (timestamp),
group_kapr = if_else((timedelta < 50), 1, 0) %>% if_else(is.na(.), 0, .) %>% cumsum()) %>%
group_by(uid, group_kapr) %>%
separate(open_cell, into = c("question", "cell"), sep = "-", convert = T)
# user_kapr <-
raw_user_data %>%
filter(type %in% c("open_cell", "kapr")) %>%
group_by(uid) %>%
arrange(timestamp) %>%
spread(type, value) %>%
mutate(timedelta = lead(timestamp) - (timestamp),
group_kapr = if_else((timedelta < 50), 1, 0) %>% if_else(is.na(.), 0, .) %>% cumsum()) %>%
group_by(uid, group_kapr) %>%
separate(open_cell, into = c("question", "cell"), sep = "-", convert = T) %>%
mutate(open_cell = str_c(question, cell)) %>%
summarise(kapr = last(kapr[!(kapr %>% is.na())]),
cell = first(open_cell) %>% str_extract(one_or_more(DIGIT)),
timestamp = first(timestamp),
timedelta = first(timedelta)) %>%
ungroup() %>%
mutate(kapr = lead(kapr) - kapr)
raw_user_data %>%
filter(type %in% c("open_cell", "kapr")) %>%
group_by(uid) %>%
arrange(timestamp) %>%
spread(type, value) %>%
mutate(timedelta = lead(timestamp) - (timestamp),
group_kapr = if_else((timedelta < 50), 1, 0) %>% if_else(is.na(.), 0, .) %>% cumsum()) %>%
group_by(uid, group_kapr) %>%
separate(open_cell, into = c("question", "cell"), sep = "-", convert = T) %>%
mutate(open_cell = str_c(question, cell))
user_questions_data
user_questions_data %>%
group_by(uid, sample) %>%
summarise(grade36 = sum(grade),
grade30 = sum(grade[!(question_type %in% attention_test)]),
percent_attention = mean(grade[question_type %in% attention_test]),
percent_attention = ifelse(is.nan(percent_attention), 1, 0),
percent36 = mean(grade)*100,
percent30 = grade30*100/30,
mean_confidence = mean(confidence),
mean_confidence_right = mean(confidence[grade == 1]),
mean_confidence_wrong = mean(confidence[grade == 0]))
user_questions_data
raw_user_data
user_questions_data
