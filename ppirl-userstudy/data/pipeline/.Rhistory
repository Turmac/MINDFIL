df_candidates_4 <-
df_candidates_3 %>%
left_join(df_lookup_scrambled_sec, by = "type") %>%
filter(page != page_x)
replacement <- NA
if(nrow(df_candidates_4) > 0){
replacement <- df_candidates_4 %>% sample_n(1) %>% pull(type)
} else if(nrow(df_candidates_3) > 0) {
replacement <- df_candidates_3 %>% sample_n(1) %>% pull(type)
} else if(nrow(df_candidates_2) > 0){
replacement <- df_candidates_2 %>% sample_n(1) %>% pull(type)
} else if(nrow(df_candidates_1) > 0){
replacement <- df_candidates_1 %>% sample_n(1) %>% pull(type)
}
# message(replacement)
# df_type_n %>% arrange(type) %>% print(n = 36)
if(!is.na(replacement)){
df_type_n$n_remaining[df_type_n$type == replacement] <<- df_type_n$n_remaining[df_type_n$type == replacement] - 1
}
df_type_n %>% arrange(type) %>% print(n = 36)
message(section)
return(replacement)
}
}))
df_lookup_scrambled_sec <-
df_lookup_scrambled_sec_pos %>%
bind_rows(df_lookup_scrambled_sec_npos) %>%
filter(!is.na(type))
# (df_type_n <-
#   df_type_n %>%
#   left_join(df_lookup_scrambled_sec, by = "type") %>%
#   group_by(type) %>%
#   summarise(n = first(n),
#             n_remaining = min(n_remaining),
#             count = n(),
#             page = first(page)) %>%
#   mutate(n_remaining = ifelse(!is.na(page), n_remaining - count, n_remaining)) %>%
#   select(-count, -page) %>%
#   arrange(n_remaining))
ls_df_lookup_scrambled[[section]] <-
df_lookup_scrambled_sec %>%
select(-page)%>%
mutate(qnum = row_number())
}
attention_test <-
df_type_group %>%
filter(group == 1) %>%
pull(type)
ls_df_lookup_scrambled <- list()
df_type_n <-
starred_data %>%
group_by(id) %>%
slice(1) %>%
ungroup() %>%
count(type) %>%
arrange(n) %>%
mutate(n_remaining = n)
#initial selection
df_lookup_scrambled_sec <-
df_target_page %>%
select(-group) %>%
group_by(page) %>%
sample_n(6) %>%
ungroup()
(df_lookup_scrambled_sec <-
df_lookup_scrambled_sec %>%
left_join(df_type_n, by = "type") %>%
mutate(type = ifelse(n_remaining < 1, NA, type)) %>%
select(page, type))
df_lookup_scrambled_sec_pos <-
df_lookup_scrambled_sec %>%
filter(!is.na(type)) %>%
mutate(type = map(type, function(type_y){
df_type_n$n_remaining[df_type_n$type == type_y] <<- df_type_n$n_remaining[df_type_n$type == type_y] - 1
}))
df_lookup_scrambled_sec_pos
attention_test <-
df_type_group %>%
filter(group == 1) %>%
pull(type)
ls_df_lookup_scrambled <- list()
df_type_n <-
starred_data %>%
group_by(id) %>%
slice(1) %>%
ungroup() %>%
count(type) %>%
arrange(n) %>%
mutate(n_remaining = n)
for(section in seq_len(11)){
#initial selection
df_lookup_scrambled_sec <-
df_target_page %>%
select(-group) %>%
group_by(page) %>%
sample_n(6) %>%
ungroup()
(df_lookup_scrambled_sec <-
df_lookup_scrambled_sec %>%
left_join(df_type_n, by = "type") %>%
mutate(type = ifelse(n_remaining < 1, NA, type)) %>%
select(page, type))
df_lookup_scrambled_sec_pos <-
df_lookup_scrambled_sec %>%
filter(!is.na(type)) %>%
mutate(type = map_chr(type, function(type_y){
df_type_n$n_remaining[df_type_n$type == type_y] <<- df_type_n$n_remaining[df_type_n$type == type_y] - 1
}))
df_lookup_scrambled_sec_npos <-
df_lookup_scrambled_sec %>%
filter(is.na(type)) %>%
mutate(type = map2_chr(page, type, function(page_x, type_y){
if(!is.na(type_y)){
browser()
df_type_n$n_remaining[df_type_n$type == type_y] <<- df_type_n$n_remaining[df_type_n$type == type_y] - 1
return(type_y)
} else{
browser()
if(length(df_type_n$n_remaining[df_type_n$n_remaining < 0]) > 0){
browser()
}
df_candidates_1 <-
df_type_n %>%
filter(n_remaining > 0)
df_candidates_2 <-
df_candidates_1 %>%
filter(!type %in% attention_test)
df_candidates_3 <-
df_candidates_2 %>%
filter(n == 12)
df_candidates_4 <-
df_candidates_3 %>%
left_join(df_lookup_scrambled_sec, by = "type") %>%
filter(page != page_x)
replacement <- NA
if(nrow(df_candidates_4) > 0){
replacement <- df_candidates_4 %>% sample_n(1) %>% pull(type)
} else if(nrow(df_candidates_3) > 0) {
replacement <- df_candidates_3 %>% sample_n(1) %>% pull(type)
} else if(nrow(df_candidates_2) > 0){
replacement <- df_candidates_2 %>% sample_n(1) %>% pull(type)
} else if(nrow(df_candidates_1) > 0){
replacement <- df_candidates_1 %>% sample_n(1) %>% pull(type)
}
# message(replacement)
# df_type_n %>% arrange(type) %>% print(n = 36)
if(!is.na(replacement)){
df_type_n$n_remaining[df_type_n$type == replacement] <<- df_type_n$n_remaining[df_type_n$type == replacement] - 1
}
df_type_n %>% arrange(type) %>% print(n = 36)
message(section)
return(replacement)
}
}))
df_lookup_scrambled_sec <-
df_lookup_scrambled_sec_pos %>%
bind_rows(df_lookup_scrambled_sec_npos) %>%
filter(!is.na(type))
# (df_type_n <-
#   df_type_n %>%
#   left_join(df_lookup_scrambled_sec, by = "type") %>%
#   group_by(type) %>%
#   summarise(n = first(n),
#             n_remaining = min(n_remaining),
#             count = n(),
#             page = first(page)) %>%
#   mutate(n_remaining = ifelse(!is.na(page), n_remaining - count, n_remaining)) %>%
#   select(-count, -page) %>%
#   arrange(n_remaining))
ls_df_lookup_scrambled[[section]] <-
df_lookup_scrambled_sec %>%
select(-page)%>%
mutate(qnum = row_number())
}
ls_df_lookup_scrambled %>%
bind_rows() %>%
count(type, sort = T)
attention_test <-
df_type_group %>%
filter(group == 1) %>%
pull(type)
ls_df_lookup_scrambled <- list()
df_type_n <-
starred_data %>%
group_by(id) %>%
slice(1) %>%
ungroup() %>%
count(type) %>%
arrange(n) %>%
mutate(n_remaining = n)
for(section in seq_len(11)){
#initial selection
df_lookup_scrambled_sec <-
df_target_page %>%
select(-group) %>%
group_by(page) %>%
sample_n(6) %>%
ungroup()
(df_lookup_scrambled_sec <-
df_lookup_scrambled_sec %>%
left_join(df_type_n, by = "type") %>%
mutate(type = ifelse(n_remaining < 1, NA, type)) %>%
select(page, type))
df_lookup_scrambled_sec_pos <-
df_lookup_scrambled_sec %>%
filter(!is.na(type)) %>%
mutate(type = map_chr(type, function(type_y){
df_type_n$n_remaining[df_type_n$type == type_y] <<- df_type_n$n_remaining[df_type_n$type == type_y] - 1
}))
df_lookup_scrambled_sec_npos <-
df_lookup_scrambled_sec %>%
filter(is.na(type)) %>%
mutate(type = map2_chr(page, type, function(page_x, type_y){
if(!is.na(type_y)){
browser()
df_type_n$n_remaining[df_type_n$type == type_y] <<- df_type_n$n_remaining[df_type_n$type == type_y] - 1
return(type_y)
} else{
if(length(df_type_n$n_remaining[df_type_n$n_remaining < 0]) > 0){
browser()
}
df_candidates_1 <-
df_type_n %>%
filter(n_remaining > 0)
df_candidates_2 <-
df_candidates_1 %>%
filter(!type %in% attention_test)
df_candidates_3 <-
df_candidates_2 %>%
filter(n == 12)
df_candidates_4 <-
df_candidates_3 %>%
left_join(df_lookup_scrambled_sec, by = "type") %>%
filter(page != page_x)
replacement <- NA
if(nrow(df_candidates_4) > 0){
replacement <- df_candidates_4 %>% sample_n(1) %>% pull(type)
} else if(nrow(df_candidates_3) > 0) {
replacement <- df_candidates_3 %>% sample_n(1) %>% pull(type)
} else if(nrow(df_candidates_2) > 0){
replacement <- df_candidates_2 %>% sample_n(1) %>% pull(type)
} else if(nrow(df_candidates_1) > 0){
replacement <- df_candidates_1 %>% sample_n(1) %>% pull(type)
}
# message(replacement)
# df_type_n %>% arrange(type) %>% print(n = 36)
if(!is.na(replacement)){
df_type_n$n_remaining[df_type_n$type == replacement] <<- df_type_n$n_remaining[df_type_n$type == replacement] - 1
}
df_type_n %>% arrange(type) %>% print(n = 36)
message(section)
return(replacement)
}
}))
df_lookup_scrambled_sec <-
df_lookup_scrambled_sec_pos %>%
bind_rows(df_lookup_scrambled_sec_npos) %>%
filter(!is.na(type))
# (df_type_n <-
#   df_type_n %>%
#   left_join(df_lookup_scrambled_sec, by = "type") %>%
#   group_by(type) %>%
#   summarise(n = first(n),
#             n_remaining = min(n_remaining),
#             count = n(),
#             page = first(page)) %>%
#   mutate(n_remaining = ifelse(!is.na(page), n_remaining - count, n_remaining)) %>%
#   select(-count, -page) %>%
#   arrange(n_remaining))
ls_df_lookup_scrambled[[section]] <-
df_lookup_scrambled_sec %>%
select(-page)%>%
mutate(qnum = row_number())
}
ls_df_lookup_scrambled %>%
bind_rows() %>%
count(type, sort = T)
ls_df_lookup_scrambled
attention_test <-
df_type_group %>%
filter(group == 1) %>%
pull(type)
ls_df_lookup_scrambled <- list()
df_type_n <-
starred_data %>%
group_by(id) %>%
slice(1) %>%
ungroup() %>%
count(type) %>%
arrange(n) %>%
mutate(n_remaining = n)
for(section in seq_len(11)){
#initial selection
df_lookup_scrambled_sec <-
df_target_page %>%
select(-group) %>%
group_by(page) %>%
sample_n(6) %>%
ungroup()
(df_lookup_scrambled_sec <-
df_lookup_scrambled_sec %>%
left_join(df_type_n, by = "type") %>%
mutate(type = ifelse(n_remaining < 1, NA, type)) %>%
select(page, type))
df_lookup_scrambled_sec_pos <-
df_lookup_scrambled_sec %>%
filter(!is.na(type)) %>%
mutate(type = map_chr(type, function(type_y){
df_type_n$n_remaining[df_type_n$type == type_y] <<- df_type_n$n_remaining[df_type_n$type == type_y] - 1
}))
df_lookup_scrambled_sec_npos <-
df_lookup_scrambled_sec %>%
filter(is.na(type)) %>%
mutate(type = map2_chr(page, type, function(page_x, type_y){
if(!is.na(type_y)){
browser()
df_type_n$n_remaining[df_type_n$type == type_y] <<- df_type_n$n_remaining[df_type_n$type == type_y] - 1
return(type_y)
} else{
if(length(df_type_n$n_remaining[df_type_n$n_remaining < 0]) > 0){
browser()
}
df_candidates_1 <-
df_type_n %>%
filter(n_remaining > 0)
df_candidates_2 <-
df_candidates_1 %>%
filter(!type %in% attention_test)
df_candidates_3 <-
df_candidates_2 %>%
filter(n == 12)
df_candidates_4 <-
df_candidates_3 %>%
left_join(df_lookup_scrambled_sec, by = "type") %>%
filter(page != page_x)
replacement <- NA
if(nrow(df_candidates_4) > 0){
replacement <- df_candidates_4 %>% sample_n(1) %>% pull(type)
} else if(nrow(df_candidates_3) > 0) {
replacement <- df_candidates_3 %>% sample_n(1) %>% pull(type)
} else if(nrow(df_candidates_2) > 0){
replacement <- df_candidates_2 %>% sample_n(1) %>% pull(type)
} else if(nrow(df_candidates_1) > 0){
replacement <- df_candidates_1 %>% sample_n(1) %>% pull(type)
}
# message(replacement)
# df_type_n %>% arrange(type) %>% print(n = 36)
if(!is.na(replacement)){
df_type_n$n_remaining[df_type_n$type == replacement] <<- df_type_n$n_remaining[df_type_n$type == replacement] - 1
}
# df_type_n %>% arrange(type) %>% print(n = 36)
# message(section)
return(replacement)
}
}))
df_lookup_scrambled_sec <-
df_lookup_scrambled_sec_pos %>%
bind_rows(df_lookup_scrambled_sec_npos) %>%
filter(!is.na(type)) %>% print(n = 36)
ls_df_lookup_scrambled[[section]] <-
df_lookup_scrambled_sec %>%
select(-page)%>%
mutate(qnum = row_number())
}
ls_df_lookup_scrambled %>%
bind_rows() %>%
count(type, sort = T)
df_target_page
#initial selection
df_lookup_scrambled_sec <-
df_target_page %>%
select(-group) %>%
group_by(page) %>%
sample_n(6) %>%
ungroup()
(df_lookup_scrambled_sec <-
df_lookup_scrambled_sec %>%
left_join(df_type_n, by = "type") %>%
mutate(type = ifelse(n_remaining < 1, NA, type)) %>%
select(page, type))
attention_test <-
df_type_group %>%
filter(group == 1) %>%
pull(type)
ls_df_lookup_scrambled <- list()
df_type_n <-
starred_data %>%
group_by(id) %>%
slice(1) %>%
ungroup() %>%
count(type) %>%
arrange(n) %>%
mutate(n_remaining = n)
#initial selection
df_lookup_scrambled_sec <-
df_target_page %>%
select(-group) %>%
group_by(page) %>%
sample_n(6) %>%
ungroup()
(df_lookup_scrambled_sec <-
df_lookup_scrambled_sec %>%
left_join(df_type_n, by = "type") %>%
mutate(type = ifelse(n_remaining < 1, NA, type)) %>%
select(page, type))
df_lookup_scrambled_sec_pos <-
df_lookup_scrambled_sec %>%
filter(!is.na(type)) %>%
mutate(type = map_chr(type, function(type_y){
df_type_n$n_remaining[df_type_n$type == type_y] <<- df_type_n$n_remaining[df_type_n$type == type_y] - 1
}))
df_lookup_scrambled_sec_pos
df_lookup_scrambled_sec
df_lookup_scrambled_sec %>%
filter(!is.na(type))
df_lookup_scrambled_sec %>%
filter(!is.na(type)) %>%
mutate(type = map_chr(type, function(type_y){
df_type_n$n_remaining[df_type_n$type == type_y] <<- df_type_n$n_remaining[df_type_n$type == type_y] - 1
}))
df_lookup_scrambled_sec
attention_test <-
df_type_group %>%
filter(group == 1) %>%
pull(type)
ls_df_lookup_scrambled <- list()
df_type_n <-
starred_data %>%
group_by(id) %>%
slice(1) %>%
ungroup() %>%
count(type) %>%
arrange(n) %>%
mutate(n_remaining = n)
for(section in seq_len(11)){
#initial selection
df_lookup_scrambled_sec <-
df_target_page %>%
select(-group) %>%
group_by(page) %>%
sample_n(6) %>%
ungroup()
(df_lookup_scrambled_sec <-
df_lookup_scrambled_sec %>%
left_join(df_type_n, by = "type") %>%
mutate(type = ifelse(n_remaining < 1, NA, type)) %>%
select(page, type))
df_lookup_scrambled_sec_pos <-
df_lookup_scrambled_sec %>%
filter(!is.na(type)) %>%
mutate(type = map_chr(type, function(type_y){
df_type_n$n_remaining[df_type_n$type == type_y] <<- df_type_n$n_remaining[df_type_n$type == type_y] - 1
return(type_y)
}))
df_lookup_scrambled_sec_npos <-
df_lookup_scrambled_sec %>%
filter(is.na(type)) %>%
mutate(type = map2_chr(page, type, function(page_x, type_y){
if(!is.na(type_y)){
browser()
df_type_n$n_remaining[df_type_n$type == type_y] <<- df_type_n$n_remaining[df_type_n$type == type_y] - 1
return(type_y)
} else{
if(length(df_type_n$n_remaining[df_type_n$n_remaining < 0]) > 0){
browser()
}
df_candidates_1 <-
df_type_n %>%
filter(n_remaining > 0)
df_candidates_2 <-
df_candidates_1 %>%
filter(!type %in% attention_test)
df_candidates_3 <-
df_candidates_2 %>%
filter(n == 12)
df_candidates_4 <-
df_candidates_3 %>%
left_join(df_lookup_scrambled_sec, by = "type") %>%
filter(page != page_x)
replacement <- NA
if(nrow(df_candidates_4) > 0){
replacement <- df_candidates_4 %>% sample_n(1) %>% pull(type)
} else if(nrow(df_candidates_3) > 0) {
replacement <- df_candidates_3 %>% sample_n(1) %>% pull(type)
} else if(nrow(df_candidates_2) > 0){
replacement <- df_candidates_2 %>% sample_n(1) %>% pull(type)
} else if(nrow(df_candidates_1) > 0){
replacement <- df_candidates_1 %>% sample_n(1) %>% pull(type)
}
# message(replacement)
# df_type_n %>% arrange(type) %>% print(n = 36)
if(!is.na(replacement)){
df_type_n$n_remaining[df_type_n$type == replacement] <<- df_type_n$n_remaining[df_type_n$type == replacement] - 1
}
# df_type_n %>% arrange(type) %>% print(n = 36)
# message(section)
return(replacement)
}
}))
df_lookup_scrambled_sec <-
df_lookup_scrambled_sec_pos %>%
bind_rows(df_lookup_scrambled_sec_npos) %>%
filter(!is.na(type)) %>% print(n = 36)
ls_df_lookup_scrambled[[section]] <-
df_lookup_scrambled_sec %>%
select(-page)%>%
mutate(qnum = row_number())
}
ls_df_lookup_scrambled %>%
bind_rows() %>%
count(type, sort = T)
ls_df_lookup_scrambled
