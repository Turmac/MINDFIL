<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>PPIRL</title>
        <link rel="shortcut icon" href="../static/images/site/favicon.ico" type="image/x-icon" />

        <link rel="stylesheet" href="../static/css/bootstrap.min.css" type="text/css">
        <link rel="stylesheet" href="../static/css/site.css" type="text/css">
        <link rel="stylesheet" href="../static/css/style.css?q=12" type="text/css">
        <link rel="stylesheet" href="../static/css/ionicons.min.css" type="text/css">
        <link rel="stylesheet" href="../static/css/select.css?q=12" type="text/css">
        <link rel="stylesheet" href="../static/css/footer.css" type="text/css">
        <link rel="stylesheet" href="../static/css/animate.min.css">


        <script src="../static/javascript/jquery-3.2.1.min.js"></script>
        <script src="../static/javascript/popper.min.js"></script>
        <script src="../static/javascript/bootstrap.min.js"></script>
        <script src="../static/javascript/site.js"></script>
        <script src="../static/javascript/choice_panel.js?v=3"></script>
        <script src="../static/javascript/grading.js"></script>
        <script src="../static/javascript/form_submit.js?v=5"></script>
        <script src="../static/javascript/clickable.js?v=10"></script>
        <script type=text/javascript>
            $SCRIPT_ROOT = {{ request.script_root|tojson|safe }};
            $THIS_URL = "{{ thisurl }}";
            $NEXT_URL = $SCRIPT_ROOT + "{{ url_for('next') }}";
            $user_data = "user in url: " + $THIS_URL + ";";
            $DELTA = {
            {% for d in delta %}
                "{{ d[0] }}":{{ d[1]}},
            {% endfor %}
            }
        </script>
    </head>

    <body>
        <div id="wrapper">
            <div id="title">
                <h3>Privacy Preserving Interactive Record Linkage (PPIRL)</h3>
            </div>
          <!--   <div id="page-number">
                （ page: {{ page_number }}/17 ）
            </div> -->
            <div style="clear:both"></div>
            <div id="content">
                <div class="privacy-budget-div">
                    <!--
                    <div>Character disclosed: <span id="character-disclosed-value">0%</span></div>
                    <div class="progress">
                        <div id="character-disclosed-bar" class="progress-bar progress-bar-striped bg-info" role="progressbar" style="width: 0%" aria-valuenow="30" aria-valuemin="0" aria-valuemax="100"></div>
                        <div class="progress-bar bg-warning" role="progressbar" style="width: 0%" aria-valuenow="20" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                    -->
                    <div>Privacy risk: <span id="privacy-risk-value">0%</span><span id="privacy-risk-delta-value"></span></div>
                    <div class="progress">
                        <div id="privacy-risk-bar" class="progress-bar progress-bar-striped bg-info" role="progressbar" style="width: 0%" aria-valuenow="30" aria-valuemin="0" aria-valuemax="100"></div>
                        <div id="privacy-risk-delta" class="progress-bar bg-warning" role="progressbar" style="width: 0%" aria-valuenow="20" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                </div>
                <div id="table">
                    <div id="table_head">
                        <div class="table_col1">Pair</div>
                        <div class="table_col2">ID</div>
                        <div class="table_col3">FFreq</div>
                        <div class="table_col4 table_names">First Name</div>
                        <div class="table_col4_5 hidden_element">s</div>
                        <div class="table_col5 table_names">Last Name</div>
                        <div class="table_col6">LFreq</div>
                        <div class="table_col7">DoB(M/D/Y)</div>
                        <div class="table_col8">Sex</div>
                        <div class="table_col9">Race</div>
                        <div class="table_col10">Choice Panel</div>
                    </div>
                    <div id="table_content">
                        {% for r in data %}
                            {% if loop.index is divisibleby 2 %}
                        <div class="table_row table_row_even">
                            {% else %}
                        <div class="table_row table_row_odd">
                            {% endif %}
                            <div class="table_col1 pair_number">{{ loop.index }}</div>
                            <div class="table_col2 clickable_cell" id = "test_col" mode="masked">
                                <div class="sub_row1" id="{{ ids[loop.index0][0][0] }}">
                                    {{ r[0][1]|safe }}
                                </div>
                                <div class="sub_row2">
                                    {{ icons[loop.index0][0]|safe }}
                                </div>
                                <div class="sub_row3" id="{{ ids[loop.index0][1][0] }}">
                                    {{ r[1][1]|safe }}
                                </div>
                            </div>
                            <div class="table_col3">
                                <div class="sub_row1 tooltip1">
                                    {{ r[0][2]|safe }}
                                    <span class="tooltiptext1">
                                        {% if 'infinity' in r[0][2] %}
                                            Very common
                                        {% elif 'common' in r[0][2] %}
                                            Common name
                                        {% elif 'rare' in r[0][2] %}
                                            Rare name
                                        {% else %}
                                            Unique name
                                        {% endif %}
                                    </span>
                                </div>
                                <div class="sub_row2">
                                </div>
                                <div class="sub_row3  tooltip1">
                                    {{ r[1][2]|safe }}
                                    <span class="tooltiptext1">
                                        {% if 'infinity' in r[1][2] %}
                                            Very common
                                        {% elif 'common' in r[1][2] %}
                                            Common name
                                        {% elif 'rare' in r[1][2] %}
                                            Rare name
                                        {% else %}
                                            Unique name
                                        {% endif %}
                                    </span>
                                </div>
                            </div>
                            
                            <div class="{% if 'svg' in icons[loop.index0][2] %}names_big_cell clickable_big_cell{% endif %}">
                            <div class="table_col4 table_names {% if 'svg' not in icons[loop.index0][2] %}clickable_cell{% endif %}" mode="masked">
                                <div class="sub_row1" id="{{ ids[loop.index0][0][1] }}">
                                    {{ r[0][3]|safe }}
                                </div>
                                <div class="sub_row2">
                                    {{ icons[loop.index0][1]|safe }}
                                </div>
                                <div class="sub_row3" id="{{ ids[loop.index0][1][1] }}">
                                    {{ r[1][3]|safe }}
                                </div>
                            </div>
                            <div class="table_col4_5">
                                {{ icons[loop.index0][2]|safe }}
                            </div>
                            <div class="table_col5 table_names {% if 'svg' not in icons[loop.index0][2] %}clickable_cell{% endif %}" mode="masked">
                                <div class="sub_row1" id="{{ ids[loop.index0][0][2] }}">
                                    {{ r[0][4]|safe }}
                                </div>
                                <div class="sub_row2">
                                    {{ icons[loop.index0][3]|safe }}
                                </div>
                                <div class="sub_row3" id="{{ ids[loop.index0][1][2] }}">
                                    {{ r[1][4]|safe }}
                                </div>
                            </div>
                            </div>
                            <div class="table_col6">
                                <div class="sub_row1 tooltip1">
                                    {{ r[0][5]|safe }}
                                    <span class="tooltiptext1">
                                        {% if 'infinity' in r[0][5] %}
                                            Very common
                                        {% elif 'common' in r[0][5] %}
                                            Common name
                                        {% elif 'rare' in r[0][5] %}
                                            Rare name
                                        {% else %}
                                            Unique name
                                        {% endif %}
                                    </span>
                                </div>
                                <div class="sub_row2">
                                </div>
                                <div class="sub_row3 tooltip1">
                                    {{ r[1][5]|safe }}
                                    <span class="tooltiptext1">
                                        {% if 'infinity' in r[1][5] %}
                                            Very common
                                        {% elif 'common' in r[1][5] %}
                                            Common name
                                        {% elif 'rare' in r[1][5] %}
                                            Rare name
                                        {% else %}
                                            Unique name
                                        {% endif %}
                                    </span>
                                </div>
                            </div>
                            <div class="table_col7 clickable_cell" mode="masked">
                                <div class="sub_row1" id="{{ ids[loop.index0][0][3] }}">
                                    {{ r[0][6]|safe }}
                                </div>
                                <div class="sub_row2">
                                    {{ icons[loop.index0][4]|safe }}
                                </div>
                                <div class="sub_row3" id="{{ ids[loop.index0][1][3] }}">
                                    {{ r[1][6]|safe }}
                                </div>
                            </div>
                            <div class="table_col8 clickable_cell" mode="masked">
                                <div class="sub_row1" id="{{ ids[loop.index0][0][4] }}">
                                    {{ r[0][7]|safe }}
                                </div>
                                <div class="sub_row2">
                                    {{ icons[loop.index0][5]|safe }}
                                </div>
                                <div class="sub_row3" id="{{ ids[loop.index0][1][4] }}">
                                    {{ r[1][7]|safe }}
                                </div>
                            </div>
                            <div class="table_col9 clickable_cell" mode="masked">
                                <div class="sub_row1" id="{{ ids[loop.index0][0][5] }}">
                                    {{ r[0][8]|safe }}
                                </div>
                                <div class="sub_row2">
                                    {{ icons[loop.index0][6]|safe }}
                                </div>
                                <div class="sub_row3" id="{{ ids[loop.index0][1][5] }}">
                                    {{ r[1][8]|safe }}
                                </div>
                            </div>
                            <div class="table_col10">
                                <div class="choice-panel">
                                    <div class="choice-label">
                                        <span class="fill"></span>
                                        <span>H</span>
                                        <span class="fill"></span>
                                        <span>M</span>
                                        <span class="fill"></span>
                                        <span>L</span>
                                        <span class="fill"></span>
                                        <span>L</span>
                                        <span class="fill"></span>
                                        <span>M</span>
                                        <span class="fill"></span>
                                        <span>H</span>
                                        <span class="fill"></span>
                                    </div>
                                    <br/>
                                    <ul class="mrate choice-button">
                                        <li class="ion-android-arrow-back"></li>
                                        <li class="ion-android-radio-button-off input_radio pair1" id="q{{ loop.index }}a1"></li>
                                        <li class="ion-android-remove"></li>
                                        <li class="ion-android-radio-button-off input_radio pair1" id="q{{ loop.index }}a2"></li>
                                        <li class="ion-android-remove"></li>
                                        <li class="ion-android-radio-button-off input_radio pair1" id="q{{ loop.index }}a3"></li>
                                        <li class="ion-android-add"></li>
                                        <li class="ion-android-radio-button-off input_radio pair1" id="q{{ loop.index }}a4"></li>
                                        <li class="ion-android-remove"></li>
                                        <li class="ion-android-radio-button-off input_radio pair1" id="q{{ loop.index }}a5"></li>
                                        <li class="ion-android-remove"></li>
                                        <li class="ion-android-radio-button-off input_radio pair1" id="q{{ loop.index }}a6"></li>
                                        <li class="ion-android-arrow-forward"></li>
                                    </ul>
                                    <br/>
                                    <ul class="choice-result">
                                        <li class="diff">Different</li>
                                        <li class="same">Same</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <div style="clear:both"></div>
                        {% endfor %}
                    </div>
                </div>
                </div>
                
                <br><br>
                
                    <div id="survey" style="width: 80%; margin-left:50px;  line-height: 1.8;">
                    <h3>Survey</h3>
                    <form action="save_survey" method="post" onsubmit="return validateForm();">
                        <ol>
                            
                            
                            <li>What do you perceive as the risks for subjects of data when using the PPIRL framework for database record linkage?
                                <ol type="a">
                                    <table width="1600">

                                    	 <tr>
                                            <th width="70%"></th>
                                            <th width="15%" style="text-align: center">First Choice</th>
                                            <th width="15%" style="text-align: center">Second Choice</th>                                        
                                        </tr>
                                    
                                         <tr>
                                            <td>
                                            <li>Potential that software will enable flawed research (e.g., linking flawed data or enabling research that uses inaccurately linked data from user or software errors)</li>
                                            </td>
                                            <td style="text-align: center"><input type="radio" name="q1_c1" value="a" id="q1_o1_c1" style="display: inline-block;" > </td>
                                            <td style="text-align: center"><input type="radio" name="q1_c2" value="a" id="q1_o1_c2" style="display: inline-block;" > </td>
                                        </tr>
                                        
                                        <tr>
                                            <td>
                                            <li>Potential for unnecessary privacy loss/identity exposure to authorized personnel (i.e., among researchers)</li>
                                            </td>
                                            <td style="text-align: center"><input type="radio" name="q1_c1" value="b" id="q1_o2_c1"  style="display: inline-block;"> </td>
                                            <td style="text-align: center"><input type="radio" name="q1_c2" value="b" id="q1_o2_c2"  style="display: inline-block;"> </td>
                                        </tr>

                                        <tr>
                                            <td>
                                            <li>Potential for privacy loss to unauthorized personnel (e.g. hacking)</li>
                                            </td>
                                             <td style="text-align: center"><input type="radio" name="q1_c1" value="c" id="q1_o3_c1"  style="display: inline-block;"> </td>
                                             <td style="text-align: center"><input type="radio" name="q1_c2" value="c" id="q1_o3_c2"  style="display: inline-block;"> </td>
                                        </tr>

                                        <tr>
                                            <td>
                                             <li>Potential for a lack of accountability for disclosures</li>
                                            </td>
                                             <td style="text-align: center"><input type="radio" name="q1_c1" value="d" id="q1_o4_c1"  style="display: inline-block;"> </td>
                                             <td style="text-align: center"><input type="radio" name="q1_c2" value="d" id="q1_o4_c2"  style="display: inline-block;"> </td>
                                        </tr>

                                         <tr>
                                            <td>
                                            <li>Possibility that an organization’s administrative controls (i.e. training and user rules) permit inappropriate use of the software.</li>
                                            </td>
                                             <td style="text-align: center"><input type="radio" name="q1_c1" value="e" id="q1_o5_c1"  style="display: inline-block;"> </td>
                                             <td style="text-align: center"><input type="radio" name="q1_c2" value="e" id="q1_o5_c2"  style="display: inline-block;"> </td>
                                        </tr>
 
                                    </table>
                                </ol>
                            </li>
                            
                            
                            <li>What do you perceive as the benefits of using the PPIRL framework for database record linkage?
                                <ol type="a">
                                    <table width="1600">
                                        <tr>
                                            <th width="70%"></th>
                                            <th width="15%" style="text-align: center">First Choice</th>
                                            <th width="15%" style="text-align: center">Second Choice</th>                                        
                                        </tr>

                                        
                                        <tr>
                                            <td>
                                            <li>Potential to reduce the <b>risk of disclosure</b></li>
                                            </td>
                                             <td style="text-align: center"><input type="radio" name="q2_c1" value="a" id="q2_o1_c1" style="display: inline-block;" > </td>
                                             <td style="text-align: center"><input type="radio" name="q2_c2" value="a" id="q2_o1_c2" style="display: inline-block;" > </td>
                                        </tr>
                                        
                                        <tr>
                                            <td>
                                            <li>Potential that the framework will promote <b>responsible and accountable data use and good data governance</b></li>
                                            </td>
                                             <td style="text-align: center"><input type="radio" name="q2_c1" value="b" id="q2_o2_c1" style="display: inline-block;"> </td>
                                             <td style="text-align: center"><input type="radio" name="q2_c2" value="b" id="q2_o2_c2" style="display: inline-block;"> </td>
                                        </tr>

                                        <tr>
                                            <td>
                                            <li>Potential to facilitate research and data sharing <b>approval processes</b></li>
                                            </td>
                                             <td style="text-align: center"><input type="radio" name="q2_c1" value="c" id="q2_o3_c1" style="display: inline-block;"> </td>
                                             <td style="text-align: center"><input type="radio" name="q2_c2" value="c" id="q2_o3_c2" style="display: inline-block;"> </td>
                                        </tr>

                                        <tr>
                                            <td>
                                             <li>Potential to facilitate the execution of <b>research protocols</b> (e.g., providing a tool for researchers to link data, de-identify data, and re-identify data)</li>
                                            </td>
                                             <td style="text-align: center"><input type="radio" name="q2_c1" value="d" id="q2_o4_c1" style="display: inline-block;"> </td>
                                             <td style="text-align: center"><input type="radio" name="q2_c2" value="d" id="q2_o4_c2" style="display: inline-block;"> </td>
                                        </tr>
 
                                    </table>
                                    
                                    
                                </ol>
                            </li>
                            
                            
                            <li>For research using the PPIRL framework for record linkage, what other information would you need to know if you were serving on the IRB as the public representative for reviewing and approving an IRB application?
                                <ol type="a">
                                    <table  width="1600">
                                        <tr>
                                            <th width="70%"></th>
                                            <th width="15%" style="text-align: center">First Choice</th>
                                            <th width="15%" style="text-align: center">Second Choice</th>                                        
                                        </tr>

                                        
                                        <tr>
                                            <td><li>Evidence for the validity of record linkage when using the software</li></td>
                                             <td style="text-align: center"><input type="radio" name="q3_c1" value="a" id="q3_o1_c1" style="display: inline-block;" > </td>
                                             <td style="text-align: center"><input type="radio" name="q3_c2" value="a" id="q3_o1_c2" style="display: inline-block;" > </td>
                                        </tr>
                                        
                                        <tr>
                                            <td><li>The administrative controls (e.g. organizational rules, policies and required training) and data governance</li></td>
                                             <td style="text-align: center"><input type="radio" name="q3_c1" value = "b" id="q3_o2_c1" style="display: inline-block;"> </td>
                                             <td style="text-align: center"><input type="radio" name="q3_c2" value = "b" id="q3_o2_c2" style="display: inline-block;"> </td>
                                        </tr>
                                        
                                        <tr>
                                            <td><li>The nature of software security and vulnerability issues, if any</li></td>
                                             <td style="text-align: center"><input type="radio" name="q3_c1" value = "c" id="q3_o3_c1" style="display: inline-block;"> </td>
                                             <td style="text-align: center"><input type="radio" name="q3_c2" value = "c" id="q3_o3_c2" style="display: inline-block;"> </td>
                                        </tr>
                                        
                                        <tr>
                                            <td><li>Specific details regarding the nature of the data used for record linkage</li></td>
                                             <td style="text-align: center"><input type="radio" name="q3_c1" value = "d" id="q3_o4_c1" style="display: inline-block;"> </td>
                                             <td style="text-align: center"><input type="radio" name="q3_c2" value = "d" id="q3_o4_c2" style="display: inline-block;"> </td> 
                                        </tr>
                                    </table>
                                </ol>
                            </li>
                        
                        
                        </ol>
<!--                        <input type="text" name="opinion">-->
                        <input type="submit" style="margin-left: 45%" id="submit">
                    
                    </form>
                </div>

<!--
                <div id="feedback">
                </div>

                <div class="submit_div">
                    <button id="button_next_rl" class="submit_button">Next</button>
                    <button id="button_next" class="submit_button" style="display: none;">Next</button>
                </div>
-->
            </div>
            
            
            <!-- End of div content -->
        </div>
        <!-- End of div wrapper -->
        <div id="footer_filler"></div>
        <footer class="footer">
            <div class="container">
                <span class="text-muted">Copyright © 2017 • Population Informatics Research Group • Texas A&M University</span>
            </div>
        </footer>
    </body>
    
    <script>

        function val(q,c){
            var qc = "q"+q+"_c"+c;
            if($("input[name="+ qc + "]:checked").val()){
                return true;
            } else {
                alert("For question "+q+', pick an option for choice '+c);
                return false;
            }
        }

        function validateForm(){

            for (var q = 1; q <= 3; q++) {
                for (var c = 1; c <= 2; c++) {
                    if(!val(q,c)){
                        return false;
                    }
                }
            }
            return true;
            // if(val(1,1) && val(1,2) && val(2,1) && val())

           // if($("input[name='q1_c1']").prop("checked")==True && $("input[name='q1_c2']").prop("checked") && $("input[name='q2_c1']").prop("checked") && $("input[name='q2_c2']").prop("checked") && $("input[name='q3_c1']").prop("checked") && $("input[name='q3_c2']").prop("checked")){
           //      return True;
           //  } else {
           //      alert("Answer all choices");
           //      return False;
           //  }
        }




        $("input[type='radio']").change(function(){
            clicked_element = $(this).attr('id');
            check_element = clicked_element.substring(0, 7) + (clicked_element.substring(7) == 1 ? 2 : 1);            
            if($("#"+check_element).is(':checked')){
                alert("Option already used. Please select a different option for this choice.");
                $("#"+clicked_element).prop("checked", false);
            }
            
        });         
    </script>
    
</html>
